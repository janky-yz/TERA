Bootstrap: docker
From: continuumio/miniconda3

%files
environment.yml /opt/environment.yml
script /opt/script

%post
conda config --add channels defaults
conda config --add channels bioconda
conda config --add channels conda-forge
conda install -n base micromamba

micromamba env create -n tera -f /opt/environment.yml
micromamba install -n tera -c bioconda gffread=0.12.1 stringtie bedtools
cp /opt/script/* /opt/conda/envs/tera/bin/
rm -f /opt/environment.yml
rm -rf /opt/script
ln -s /opt/conda/envs/tera/lib/libcrypto.so.1.1 /opt/conda/envs/tera/lib/libcrypto.so.1.0.0

%environment
export LC_ALL=C
export PATH="/opt/conda/envs/tera/bin:$PATH"
